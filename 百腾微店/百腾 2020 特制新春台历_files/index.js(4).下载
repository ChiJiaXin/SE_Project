!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):e["evoke-app"]=i()}(this,function(){"use strict";var e,v=(function(e,i){var t,n,r,o,s,a,c,u,d,p,f,l,w,m;window,e.exports=(t=navigator.userAgent.toLowerCase(),n=/(Android)\s+([\d.]+)/i,r=/\(i[^;]+;( U;)? cpu.+mac os x/i,o=/Windows Phone ([\d.]+)/i,s=/(iPhone|iPad|iPod|iOS)/i,a=/(iPad).*OS\s([\d_]+)/i,c=/(iPhone\sOS)\s([\d_]+)/i,u=/QQ/i,d=/micromessenger/i,p=/wxwork\/.* MicroMessenger/i,f=/WeiBo/i,l=/(wdbuyer)/i,w=/(com.koudai.weishop)/i,(m=Object.create(null)).isMobile=function(){return!!t.match(/AppleWebKit.*Mobile.*/i)},m.isAndriod=function(){return!!n.test(t)},m.isIOS=function(){return!!r.test(t)},m.isWP=function(){return!!o.test(t)},m.isApple=function(){return!!s.test(t)},m.isIphone=function(){return!!c.test(t)},m.isIpad=function(){return!!a.test(t)},m.isQQ=function(){return!!u.test(t)},m.isWX=function(){return!!d.test(t)},m.isWXWork=function(){return!!p.test(t)},m.isWeiBo=function(){return!!f.test(t)},m.isWDbuyer=function(){return!!l.test(t)},m.checkAppVersion=function(){if(!m.isWDbuyer())return console.warn("非买家版App内无法获取版本号"),0;var n="",e="";return e=m.isAndriod()?/wdbuyer\/(\d+\.\d+\.\d+(.\d+)?)/i:/wdbuyer\/(\d+\.\d+\.\d+)/i,t.replace(e,function(e,i){n=parseInt(i.split(".").join(""))}),n},m.isWDSeller=function(){return!!w.test(t)},m.isMiniprogram=function(){return"miniprogram"===window.__wxjs_environment},m)}(e={exports:{}},e.exports),e.exports);function k(e,i){return!(2<arguments.length&&void 0!==arguments[2])||arguments[2]?Object.assign(e,i):Object.assign(i,e)}function S(e){var i="";if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),t=0;t<n.length;t++){var r=n[t].replace(/^\s+|\s+$/g,"");if(r.substring(0,e.length+1)===e+"="){i=decodeURIComponent(r.substring(e.length+1));break}}return i}function A(e,i){var n="jsonp_"+Date.now()+"_"+Math.random().toString().substr(2),t="callback",r=document.createElement("script");r.src=-1===e.indexOf("?")?e+"?"+t+"="+n+"&wfr_public="+JSON.stringify({referService:"h5-shop"}):e+"&"+t+"="+n+"&wfr_public="+JSON.stringify({referService:"h5-shop"}),window[n]=function(e){try{void 0!==i&&i(e)}finally{delete window[n],r.parentNode&&r.parentNode.removeChild(r)}},document.body.appendChild(r)}v.isIOSWXHigher=function(e){return!0},v.isQQBrowser=function(){var e=window.navigator.userAgent.toLowerCase();return!(!/MQQBrowser/i.test(e)||v.isWX()||/TBS/i.test(e))},v.isAndriodWebview=function(){var e=window.navigator.userAgent.toLowerCase();return!(!/version/i.test(e)||!v.isAndriod())},v.isUCBrowser=function(){var e=window.navigator.userAgent.toLowerCase();return!!/ucbrowser/i.test(e)},v.isOppoBrowser=function(){var e=window.navigator.userAgent.toLowerCase();return!!/oppobrowser/i.test(e)},v.isBaidu=function(){var e=window.navigator.userAgent.toLowerCase();return!!/baidu/i.test(e)},v.isBaiduApp=function(){var e=window.navigator.userAgent.toLowerCase();return!!/baiduboxapp/i.test(e)},v.isSafari=function(){var e=window.navigator.userAgent.toLowerCase();return!(!/Safari/i.test(e)||/Chrome/i.test(e))},v.isHuawei=function(){var e=window.navigator.userAgent.toLowerCase();return!!/HUAWEI/i.test(e)},v.isWDBuyer=v.isWDbuyer;var i="//thor.weidian.com",n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W=function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,i){var n=[],t=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(t=(s=a.next()).done)&&(n.push(s.value),!i||n.length!==i);t=!0);}catch(e){r=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},O={download:{iOS:"https://itunes.apple.com/cn/app/id860384719?mt=8",android:"https://thor.weidian.com/commonserver/publish.redirectApkCdnUrl/1.0",yyb:"http://a.app.qq.com/o/simple.jsp?pkgname=com.koudai.weidian.buyer"},appLink:"https://wdb-applink.weidian.com",crossPage:"https://h5.weidian.com/v-components/evoke-app/index.html",homePage:"https://weidian.com",schemeAlias:{shop:"weidianbuyer://wdb/shop_detail",item:"weidianbuyer://wdb/goods_detail"}};function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};-1!==location.href.indexOf("debug")&&console.warn("EvokeApp options",a);var s=i,c=!!document.queryCommandSupported&&document.queryCommandSupported("copy"),r=document.activeElement,u=l(f(location.href).search),e=function(e){if("shop"===e){var i=w(O.schemeAlias[e],{shopId:u.userid});return i}if("item"===e){var n=w(O.schemeAlias[e],{itemId:u.itemID});return n}if(o("http:",e)||o("https:",e)){if("koudai.com"===f(e).hostname){var t=f(e);t.hostname="weidian.com",e=t.href}return"weidianbuyer://wdb/webview?url="+encodeURIComponent(e)}return e}((a=k({expires:24e4,scheme:location.href,mode:"auto",installed:!1,guideToOpenBrowser:!1},a)).scheme),d=w("weidianbuyer://clipboard",{timestamp:(new Date).getTime()+a.expires,targetUrl:w(e,{clipboard:1,h5:1,wxWake:1,ckey:a.ckey,subckey:a.subckey,wfr:u.wfr},!1)}),p=w(e,{h5:1,wxWake:1,ckey:a.ckey,subckey:a.subckey,wfr:u.wfr},!1);function f(e){var i=document.createElement("a");return i.href=e,i}function l(e){var o={};return e.substr(1)&&e.substr(1).split("&").forEach(function(e){var i=e.split("="),n=W(i,2),t=n[0],r=n[1];o[t]=decodeURIComponent(r)}),o}function w(e,i){var n,t,r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=l((e=f(e)).search);return o=k(o,i,r),Object.keys(o).forEach(function(e){o[e]||delete o[e]}),n=o,t=[],Object.keys(n).forEach(function(e){t.push(e+"="+encodeURIComponent(n[e]))}),o=t.join("&")&&"?"+t.join("&"),""+((e.hostname?e.origin:e.protocol)+e.pathname)+o+e.hash}function o(e,i){return i=f(i),-1!==e.indexOf(i.protocol)}function m(e){var i=void 0;try{var n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style.right="-9999px";var t=window.pageYOffset||document.documentElement.scrollTop;n.style.top=t+"px",n.setAttribute("readonly",""),n.value=e,document.body.appendChild(n),n.select(),n.setSelectionRange(0,n.value.length),i=document.execCommand("copy"),document.body.removeChild(n),r.focus()}catch(e){console.warn(e),i=!1}return i}function y(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:240;a.appendTag&&a.appendTag.length?A(s+"/hebe/tag.appendTag/1.0?param="+JSON.stringify({uid:S("uid"),source:"user_track",bizTagCodes:a.appendTag}),function(){setTimeout(function(){location.href=e},i)}):setTimeout(function(){location.href=e},i)}function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:120;if((a.installed||a.guideToOpenBrowser)&&v.isWX())g();else{y(w(v.isIOS()?O.download.iOS:v.isAndriod()&&v.isWX()?O.download.yyb:a.channel&&(v.isQQBrowser()||v.isWDSeller()||v.isUCBrowser()||v.isBaidu()||!v.isAndriodWebview())?w(O.download.android,{param:JSON.stringify({appName:"wdbuyer",channel:a.channel})}):O.download.yyb,{ckey:a.ckey,subckey:a.subckey,wfr:u.wfr}),e)}}function b(e){var i=e.spmc,n=void 0===i?"_download":i,t=e.actionName,r=void 0===t?"_download":t,o=e.actionArgs,s=void 0===o?{}:o;a.ckey&&(s.ckey=a.ckey),a.subckey&&(s.subckey=a.subckey),window.spider&&window.spider.trackAction({spmc:n,spmd:"1",actionName:r,actionArgs:s})}function g(){y(w(O.crossPage,{type:1,ckey:a.ckey,subckey:a.subckey,channel:a.channel,scheme:a.scheme}))}b({spmc:a.spmc,actionName:a.actionName,actionArgs:a.actionArgs}),function(e){if(v.isMobile())if(c&&m(d),"evokeOnly"!==e.mode)if("download"!==e.mode)if("sms"!==e.mode){if("wechat"===e.mode&&v.isWX()){if(v.isIOS()&&v.isIOSWXHigher("7.0.5"))return y(w(O.appLink,{targetUrl:p,h5:1,wxWake:1,ckey:e.ckey,subckey:e.subckey,wfr:u.wfr}));if(v.isAndriod())return;if(v.isIOS()&&!v.isIOSWXHigher("7.0.5"))return}if(v.isWDbuyer())y(p,0);else if(v.isIOS()&&v.isWX()&&v.isIOSWXHigher("7.0.5"))y(w(O.appLink,{targetUrl:p,h5:1,wxWake:1,ckey:e.ckey,subckey:e.subckey,wfr:u.wfr}));else{if(v.isWeiBo())return c&&m(d),g();if(v.isWX()||v.isQQ()||v.isAndriod()&&v.isBaidu())return c&&m(d),h();if(v.isWDSeller()&&KDJSBridge2){var i={url:p};KDJSBridge2.call("WDJSBridge","canOpenOuterLink",i,function(e){0==e.param.result?KDJSBridge2.call("WDJSBridge","openOuterLink",i,function(e){0!=e.param.result&&h()}):h()})}else{var t,r,o;v.isIOS()?y(w(O.appLink,{targetUrl:p,h5:1,wxWake:1,ckey:e.ckey,subckey:e.subckey,wfr:u.wfr})):(y(p),t=function(){},r=function(){h(100)},o=(new Date).getTime(),setTimeout(function(){var e=document.hidden,i=document.visibilityState,n=3100<(new Date).getTime()-o;switch(!0){case e:case"hidden"===i:case n:t();break;default:r()}},3e3))}}}else y(p);else h(500);else{c?(m(e.scheme),b({spmc:"evokeapp",actionName:"copySuccessed",actionArgs:{text:e.scheme}})):b({spmc:"evokeapp",actionName:"copyFailed",actionArgs:{ua:navigator.userAgent}});var n=function(e){if(!(S("WD_b_id")&&S("WD_b_wduss")&&"true"==S("isLogin")||S("uid")&&S("is_login")))return"";if(!e)return"common";try{return 1==(e=JSON.parse(e)).type?"double":2==e.type?"withdrawal":3==e.type&&e.rightsType&&e.renderType?e.rightsType+"_"+e.renderType:""}catch(e){return""}}(e.scheme);n?A(s+"/hebe/tag.appendTag/1.0?param="+JSON.stringify({uid:S("uid"),source:"user_track",bizTagCodes:[n]}),function(){v.isWX()||v.isQQ()||v.isAndriod()&&v.isWeiBo()||v.isAndriod()&&v.isBaidu()?h():v.isWDbuyer()?y("weidianbuyer://",0):v.isIOS()?y(O.appLink):(y("weidianbuyer://"),h(2e3))}):v.isWX()||v.isQQ()||v.isAndriod()&&v.isWeiBo()||v.isAndriod()&&v.isBaidu()?h():v.isWDbuyer()?y("weidianbuyer://",0):v.isIOS()?y(O.appLink):(y("weidianbuyer://"),h(2e3))}else y(w(O.homePage,{ckey:e.ckey,subckey:e.subckey,channel:e.channel,scheme:e.scheme}))}(a)}return"function"==typeof define&&define.cmd&&define(function(e,i,n){return t}),"object"===("undefined"==typeof window?"undefined":n(window))&&(window.lib=window.lib||{},window.lib.EvokeApp=t,window.lib.EvokeApp.version="1.6.12"),t});
