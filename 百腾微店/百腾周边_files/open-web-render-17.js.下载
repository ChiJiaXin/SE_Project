(window.openRenderLibJsonp=window.openRenderLibJsonp||[]).push([[17],{147:function(e,t,o){"use strict";o.r(t);var n=o(148),i=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,function(){return n[e]})}(s);t.default=i.a},148:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(o(60)),i=a(o(64)),s=a(o(418)),r=o(149);function a(e){return e&&e.__esModule?e:{default:e}}var p=window.API,u=p.env,h=p.Bus,d=(p.Echo,p.navUrl),c=p.isLogin,f=(p.source,u.get()),l=u.get("envStr");t.default={name:"Coupon",mixins:[i.default,s.default],props:["model","env","template"],data:function(){return{ArrayCache:[],shopId:f.shopId,userId:f.userId,shopOffs:f.shopOffs,freeShipping:f.freePostageEnterShow,shopMoneyFreePostages:f.shopMoneyFreePostages,shopNumFreePostages:f.shopNumFreePostages,isShowArrow:!0,isDecorate:f.isDecorate,isPC:f.isPC}},computed:{offs:function(){return this.shopOffs&&this.shopOffs.length?"全店 "+this.shopOffs.reduce(function(e,t){var o=e;return o+="满"+parseInt(t.full_price||t.fullPrice)+"元减"+parseInt(t.reduce_price||t.reducePrice)+"元 "},"").replace(/；$/,""):""},isShow:function(){return this.model.content&&this.model.content.length>0||this.offs||this.freeShipping}},created:function(){this.model&&this.template&&("rt"===this.env?(this.$set(this.model,"content",[]),this.getCouponList()):"edit"===this.env&&(this.shopOffs=this.model.shopOffs,this.freeShipping=this.model.freePostageEnterShow))},mounted:function(){var e=this;"rt"===this.env&&this.$on("clickEvent",function(t){t.event;var o=t.eventName,n=t.key,i=t.index,s=void 0;s="number"==typeof n?e.ArrayCache[n]:e.model,"coupon"===o?e.receiveCoupon(s,i):"remoteArea"===o&&e.showRemoteArea()})},methods:{mergeData:function(){this.specialTemplatePassParams();var e=this.getUsedData(this.model),t=JSON.parse((0,n.default)(this.template));return this.processModule(t,e),t},specialTemplatePassParams:function(){var e=this.template,t=e.comId,o=e.tptId,n=e.version;"coupon"===t&&"normal"===o&&(this.model.version=n)},getCouponList:function(){var e=this;(0,r.getCouponListByShop)({shop_id:e.shopId,buyer_id:e.userId},function(t){e.$set(e.model,"content",t.coupon_list)})},receiveCoupon:function(e,t){var o=this;if(e.status)return!1;e.status=3,c(!0)&&(0,r.fetchShopCoupon)({retailId:o.shopId,shopId:e.shopId,couponId:e.id},function(n){if(n){var i=n.buyer_coupon_status;o.model.content[t].status=i,o.$set(o.model.content,t,o.model.content[t]),4===i&&o.model.content.splice(t,1);var s='成功添加到 "我的订单"-"我的优惠券"\n有效期至'+e.endTime;if("shop"===e.type){var r={content:s};e.appOnly&&(r.content='成功添加到 "我的订单"-"我的优惠券"\n本优惠券仅可在微店App使用\n有效期至'+e.endTime,r.buttons=[{txt:"去微店APP",exe:function(e){e(),d(f.appUrl,"goAppFromCoupon")}},"确定"]),h.emit("showConfirm",r)}else h.emit("showConfirm",{content:s,buttons:[{txt:"查看可用商品",exe:function(t){t(),d("//h5."+l+"weidian.com/m/mycoupon/list.html?shop_id="+e.shopId+"&coupon_id="+e.id+"&retail_id="+o.shopId,"goCouponDetail")}},"关闭"]})}},function(t){e.status=0,h.emit("showToast",{content:t&&t.status&&t.status.message||"领取优惠券失败"})})},showRemoteArea:function(){if(!window.isPreview){var e=[],t=[],o=[];this.shopMoneyFreePostages&&this.shopMoneyFreePostages.map(function(e){t.push(e.freeInfo)}),this.shopNumFreePostages&&this.shopNumFreePostages.map(function(e){o.push(e.freeInfo)}),t.length&&(e.push({tag:"满金额包邮"}),e.push({txt:t.join("\n\n")})),o.length&&(e.push({tag:"满件数包邮"}),e.push({txt:o.join("\n\n")})),0==e.length&&(e=this.freeShipping),h.emit("showConfirm",{title:"【店铺包邮规则】",content:e,textAlign:"left"})}}}}},149:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCouponListByShop=function(e,t,o){var i=e.shop_id,s=e.buyer_id;(0,n.ThorMin)("/vmpcoupon/getCouponListByShop/1.0",{shop_id:i,buyer_id:s,page_size:100},t,o)},t.fetchShopCoupon=function(e,t,o){var i=e.shopId,s=e.retailId,r=e.couponId;(0,n.ThorMin)("/vmpcoupon/fetchShopCoupon/1.0",{shop_id:i,retail_id:s||i,coupon_id:r,type:"h5"},t,o,"GET",!0)},t.batchFetchShopCoupon=function(e,t,o){var i=e.couponList,s=e.userId;(0,n.ThorMin)("/vmpcoupon/buyer.batchFetchShopCoupon/1.0",{couponQueryList:i.map(function(e){return e.appId="shop_"+s+"_"+Date.now()+"_"+e.retailId+"_"+e.couponId,e}),fromScope:"vmpcoupon"},t,o,"GET",!0)};var n=o(62)},150:function(e,t,o){var n=o(421);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0};o(55)(n,i);n.locals&&(e.exports=n.locals)},28:function(e,t,o){"use strict";o.r(t);var n=o(633),i=o(147);for(var s in i)"default"!==s&&function(e){o.d(t,e,function(){return i[e]})}(s);o(420);var r=o(53),a=Object(r.a)(i.default,n.a,n.b,!1,null,"58cf381e",null);a.options.__file="workspace/edf2a1fc78b3d80980bb07447dd66c12/decoration_open-modules_prod/src/coupon/web/index.vue",t.default=a.exports},418:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(o(59)),i=r(o(71)),s=r(o(419));function r(e){return e&&e.__esModule?e:{default:e}}t.default={methods:{findLimit:function(e){var t=!0,o=!1,n=void 0;try{for(var s,r=(0,i.default)(e.nodes);!(t=(s=r.next()).done);t=!0){var a=s.value;if("list"===a.type)return a.attr?a.attr.limit:void 0}}catch(e){o=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(o)throw n}}},getUsedData:function(e){var t=this,o=e.content||[],i=t.findLimit(t.template),r={};return r=e.version?{hideList:1!==o.length,hideList2:2!==o.length,hideList3:3!==o.length,hideList4:o.length<4}:{hideList:0===o.length},(0,n.default)({offs:t.offs,hideOffs:0===t.offs.length,freeShipping:t.freeShipping,hideFreeShipping:!t.freeShipping||0===t.freeShipping.length,hideRightArrow:!t.isShowArrow,content:o.map(function(e){e=(0,s.default)(e,i);var o=t.ArrayCache.length;return t.ArrayCache.push(e),e._key=o,e})},r)}}}},419:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:999,o=parseInt(e.reduce)/100,n=parseInt(e.full)/100;return t>0&&o>t&&(o=t+"+"),{id:e.id,buyerLimit:e.buyer_limit,type:e.type,typeName:e.scopeText||("shop"===e.type?"全店通用":"限定商品"),reduce:o,full:n,status:e.status,shopId:e.shop_id,appOnly:e.shop_coupon&&e.shop_coupon.app_only,hideReceived:0===e.status,hideUnreceived:e.status>0,hideSoldOut:e.status<2,endTime:e.end_time&&e.end_time.replace(/\./g,"/").split(" ")[0]}}},420:function(e,t,o){"use strict";var n=o(150);o.n(n).a},421:function(e,t,o){(e.exports=o(54)()).push([e.i,"\n.empty-hide[data-v-58cf381e]{background-color:#4d4f50!important;color:#7d7f80;font-size:.4rem;height:1.986667rem;line-height:.8rem;margin-top:.4rem;padding:.4rem\n}\n.empty-hide.pc-hide[data-v-58cf381e]{background:#e6e7e9!important;border:1px dashed #9a9a9a;color:#9a9a9a;font-size:.373333rem;height:auto;line-height:.533333rem;margin-top:0;text-align:left\n}\n.empty-hide.pc-hide .tips[data-v-58cf381e]{color:#9a9a9a;font-size:.32rem\n}",""])},633:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ct"},[e.isShow?e._t("default",null,{data:e.moduleData}):e.isDecorate&&"preview"!==e.env?o("div",{staticClass:"empty-hide",class:{"pc-hide":e.isPC},style:{marginTop:e.template.style&&e.template.style.marginTop||0}},[e._v("\n        暂无优惠券等信息，预览店铺不会展示\n    ")]):e._e()],2)},i=[];n._withStripped=!0,o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})}}]);